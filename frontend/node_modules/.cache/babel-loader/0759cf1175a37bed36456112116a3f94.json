{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.sessionReducer = exports.sessionService = undefined;\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _constants = require('./constants');\n\nvar _jsCookie = require('js-cookie');\n\nvar Cookies = _interopRequireWildcard(_jsCookie);\n\nvar _isPromise = require('is-promise');\n\nvar _isPromise2 = _interopRequireDefault(_isPromise);\n\nvar _actions = require('./actions');\n\nvar _reducer = require('./reducer');\n\nvar _reducer2 = _interopRequireDefault(_reducer);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nvar instance = void 0;\n\nvar sessionService = exports.sessionService = function () {\n  function sessionService(store, options) {\n    _classCallCheck(this, sessionService);\n\n    instance = this;\n    sessionService.setOptions(store, options);\n    return instance;\n  }\n\n  _createClass(sessionService, null, [{\n    key: 'setOptions',\n    value: function setOptions(store) {\n      var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n          driver = _ref.driver,\n          validateSession = _ref.validateSession,\n          _ref$refreshOnCheckAu = _ref.refreshOnCheckAuth,\n          refreshOnCheckAuth = _ref$refreshOnCheckAu === undefined ? false : _ref$refreshOnCheckAu,\n          _ref$expires = _ref.expires,\n          expires = _ref$expires === undefined ? 360 : _ref$expires,\n          _ref$redirectPath = _ref.redirectPath,\n          redirectPath = _ref$redirectPath === undefined ? 'login' : _ref$redirectPath,\n          _ref$server = _ref.server,\n          server = _ref$server === undefined ? false : _ref$server;\n\n      instance.store = store;\n      instance.refreshOnCheckAuth = refreshOnCheckAuth;\n      instance.redirectPath = redirectPath;\n      instance.expires = expires;\n      instance.driver = driver;\n      instance.server = server;\n      instance.validateSession = validateSession; // configure the storage\n\n      var storageOptions = {\n        name: 'redux-react-session'\n      };\n\n      var localforage = require('localforage');\n\n      if (driver && driver !== 'COOKIES') {\n        storageOptions.driver = localforage[driver];\n      }\n\n      instance.storage = localforage.createInstance(storageOptions);\n    }\n  }, {\n    key: 'initSessionService',\n    value: function initSessionService(store, options) {\n      instance = new sessionService(store, options);\n      return sessionService.refreshFromLocalStorage();\n    }\n  }, {\n    key: 'initServerSession',\n    value: function initServerSession(store, req, options) {\n      instance = new sessionService(store, _extends({}, options, {\n        server: true\n      }));\n\n      var parseCookies = function parseCookies(req) {\n        var list = {};\n        var rc = req.get('cookie');\n        rc && rc.split(';').forEach(function (cookie) {\n          var parts = cookie.split('=');\n\n          if (parts[0].trim() === _constants.USER_SESSION || parts[0].trim() === _constants.USER_DATA) {\n            list[parts[0].trim()] = JSON.parse(decodeURIComponent(parts[1]));\n          }\n        });\n        return list;\n      };\n\n      return sessionService.saveFromClient(parseCookies(req));\n    }\n  }, {\n    key: 'saveFromClient',\n    value: function saveFromClient(cookies) {\n      return new Promise(function (resolve, reject) {\n        if (cookies[_constants.USER_SESSION]) {\n          sessionService.saveSession(cookies[_constants.USER_SESSION]).then(function () {\n            if (cookies[_constants.USER_DATA]) {\n              sessionService.saveUser(cookies[_constants.USER_DATA]).then(function () {\n                return resolve();\n              });\n            } else {\n              return resolve();\n            }\n          });\n        } else {\n          instance.store.dispatch((0, _actions.getSessionError)());\n          reject('Session not found');\n        }\n      });\n    }\n  }, {\n    key: 'invalidateSession',\n    value: function invalidateSession() {\n      instance.store.dispatch((0, _actions.invalidSession)());\n      sessionService.deleteSession();\n      sessionService.deleteUser();\n    }\n  }, {\n    key: 'attemptLoadUser',\n    value: function attemptLoadUser() {\n      instance.store.dispatch((0, _actions.getSessionSuccess)());\n      return sessionService.loadUser().then(function (user) {\n        instance.store.dispatch((0, _actions.getUserSessionSuccess)(user));\n      }).catch(function () {\n        instance.store.dispatch((0, _actions.getUserSessionError)());\n      });\n    }\n  }, {\n    key: 'refreshFromLocalStorage',\n    value: function refreshFromLocalStorage() {\n      var _this = this;\n\n      return sessionService.loadSession().then(function (session) {\n        if (instance.validateSession) {\n          var value = instance.validateSession(session);\n\n          if ((0, _isPromise2.default)(value)) {\n            return value.then(function (valid) {\n              if (!valid) {\n                throw new Error(\"Session is invalid\");\n              }\n\n              return _this.attemptLoadUser();\n            }).catch(function () {\n              _this.invalidateSession();\n            });\n          } else if (!value) {\n            _this.invalidateSession();\n\n            return;\n          }\n        }\n\n        return _this.attemptLoadUser();\n      }).catch(function () {\n        instance.store.dispatch((0, _actions.getSessionError)());\n      });\n    }\n  }, {\n    key: 'checkAuth',\n    value: function checkAuth(nextState, replace, next) {\n      var _instance = instance,\n          refreshOnCheckAuth = _instance.refreshOnCheckAuth,\n          store = _instance.store;\n      sessionService.loadSession().then(function () {\n        refreshOnCheckAuth && store.dispatch((0, _actions.getSessionSuccess)());\n        sessionService.loadUser().then(function (user) {\n          refreshOnCheckAuth && store.dispatch((0, _actions.getUserSessionSuccess)(user));\n          next();\n        }).catch(function () {\n          return next();\n        });\n      }).catch(function () {\n        refreshOnCheckAuth && store.dispatch((0, _actions.getSessionError)());\n        refreshOnCheckAuth && store.dispatch((0, _actions.getUserSessionError)());\n        replace({\n          pathname: instance.redirectPath,\n          state: {\n            nextPathname: nextState.location.pathname\n          }\n        });\n        next();\n      });\n    }\n  }, {\n    key: 'saveSession',\n    value: function saveSession(session) {\n      return new Promise(function (resolve) {\n        if (instance.server) {\n          instance[_constants.USER_SESSION] = session;\n          instance.store.dispatch((0, _actions.getSessionSuccess)());\n          resolve();\n        } else if (instance.driver === 'COOKIES') {\n          Cookies.set(_constants.USER_SESSION, session, {\n            expires: instance.expires\n          });\n          instance.store.dispatch((0, _actions.getSessionSuccess)());\n          resolve();\n        } else {\n          instance.storage.setItem(_constants.USER_SESSION, session).then(function () {\n            instance.store.dispatch((0, _actions.getSessionSuccess)());\n            resolve();\n          }).catch(function () {\n            Cookies.set(_constants.USER_SESSION, session, {\n              expires: instance.expires\n            });\n            instance.store.dispatch((0, _actions.getSessionSuccess)());\n            resolve();\n          });\n        }\n      });\n    }\n  }, {\n    key: 'loadSession',\n    value: function loadSession() {\n      return new Promise(function (resolve, reject) {\n        if (instance.server) {\n          instance[_constants.USER_SESSION] ? resolve(instance[_constants.USER_SESSION]) : reject();\n        } else if (instance.driver === 'COOKIES') {\n          var cookies = Cookies.getJSON(_constants.USER_SESSION);\n          cookies ? resolve(cookies) : reject('Session not found');\n        } else {\n          instance.storage.getItem(_constants.USER_SESSION).then(function (currentSession) {\n            if (currentSession) {\n              resolve(currentSession);\n            } else {\n              var _cookies = Cookies.getJSON(_constants.USER_SESSION);\n\n              _cookies ? resolve(_cookies) : reject('Session not found');\n            }\n          }).catch(function (err) {\n            return reject(err);\n          });\n        }\n      });\n    }\n  }, {\n    key: 'deleteSession',\n    value: function deleteSession() {\n      return instance.storage.removeItem(_constants.USER_SESSION).then(function () {\n        instance.store.dispatch((0, _actions.getSessionError)());\n        Cookies.remove(_constants.USER_SESSION);\n        delete instance[_constants.USER_SESSION];\n      });\n    }\n  }, {\n    key: 'saveUser',\n    value: function saveUser(user) {\n      return new Promise(function (resolve) {\n        if (instance.server) {\n          instance[_constants.USER_DATA] = user;\n          instance.store.dispatch((0, _actions.getUserSessionSuccess)(user));\n          resolve();\n        } else if (instance.driver === 'COOKIES') {\n          Cookies.set(_constants.USER_DATA, user, {\n            expires: instance.expires\n          });\n          instance.store.dispatch((0, _actions.getUserSessionSuccess)(user));\n          resolve();\n        } else {\n          instance.storage.setItem(_constants.USER_DATA, user).then(function (user) {\n            instance.store.dispatch((0, _actions.getUserSessionSuccess)(user));\n            resolve();\n          }).catch(function () {\n            instance.store.dispatch((0, _actions.getUserSessionSuccess)(user));\n            Cookies.set(_constants.USER_DATA, user, {\n              expires: instance.expires\n            });\n            resolve();\n          });\n        }\n      });\n    }\n  }, {\n    key: 'loadUser',\n    value: function loadUser() {\n      return new Promise(function (resolve, reject) {\n        if (instance.server) {\n          instance[_constants.USER_DATA] ? resolve(instance[_constants.USER_DATA]) : reject();\n        } else if (instance.driver === 'COOKIES') {\n          var cookies = Cookies.getJSON(_constants.USER_DATA);\n          cookies ? resolve(cookies) : reject('User not found');\n        } else {\n          instance.storage.getItem(_constants.USER_DATA).then(function (currentUser) {\n            if (currentUser) {\n              resolve(currentUser);\n            } else {\n              var _cookies2 = Cookies.getJSON(_constants.USER_DATA);\n\n              _cookies2 ? resolve(_cookies2) : reject('User not found');\n            }\n          }).catch(function (err) {\n            return reject(err);\n          });\n        }\n      });\n    }\n  }, {\n    key: 'deleteUser',\n    value: function deleteUser() {\n      return instance.storage.removeItem(_constants.USER_DATA).then(function () {\n        instance.store.dispatch((0, _actions.getUserSessionError)());\n        Cookies.remove(_constants.USER_DATA);\n        delete instance[_constants.USER_DATA];\n      });\n    }\n  }]);\n\n  return sessionService;\n}();\n\nvar sessionReducer = exports.sessionReducer = _reducer2.default;","map":{"version":3,"sources":["/Volumes/LocalDiskC/MERN/QuizWebsite/QuizWebsite/frontend/node_modules/redux-react-session/dist/index.js"],"names":["Object","defineProperty","exports","value","sessionReducer","sessionService","undefined","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_createClass","defineProperties","props","descriptor","enumerable","configurable","writable","Constructor","protoProps","staticProps","_constants","require","_jsCookie","Cookies","_interopRequireWildcard","_isPromise","_isPromise2","_interopRequireDefault","_actions","_reducer","_reducer2","obj","__esModule","default","newObj","_classCallCheck","instance","TypeError","store","options","setOptions","_ref","driver","validateSession","_ref$refreshOnCheckAu","refreshOnCheckAuth","_ref$expires","expires","_ref$redirectPath","redirectPath","_ref$server","server","storageOptions","name","localforage","storage","createInstance","initSessionService","refreshFromLocalStorage","initServerSession","req","parseCookies","list","rc","get","split","forEach","cookie","parts","trim","USER_SESSION","USER_DATA","JSON","parse","decodeURIComponent","saveFromClient","cookies","Promise","resolve","reject","saveSession","then","saveUser","dispatch","getSessionError","invalidateSession","invalidSession","deleteSession","deleteUser","attemptLoadUser","getSessionSuccess","loadUser","user","getUserSessionSuccess","catch","getUserSessionError","_this","loadSession","session","valid","Error","checkAuth","nextState","replace","next","_instance","pathname","state","nextPathname","location","set","setItem","getJSON","getItem","currentSession","_cookies","err","removeItem","remove","currentUser","_cookies2"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.sessionReducer = exports.sessionService = undefined;\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _constants = require('./constants');\n\nvar _jsCookie = require('js-cookie');\n\nvar Cookies = _interopRequireWildcard(_jsCookie);\n\nvar _isPromise = require('is-promise');\n\nvar _isPromise2 = _interopRequireDefault(_isPromise);\n\nvar _actions = require('./actions');\n\nvar _reducer = require('./reducer');\n\nvar _reducer2 = _interopRequireDefault(_reducer);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar instance = void 0;\n\nvar sessionService = exports.sessionService = function () {\n  function sessionService(store, options) {\n    _classCallCheck(this, sessionService);\n\n    instance = this;\n    sessionService.setOptions(store, options);\n    return instance;\n  }\n\n  _createClass(sessionService, null, [{\n    key: 'setOptions',\n    value: function setOptions(store) {\n      var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n          driver = _ref.driver,\n          validateSession = _ref.validateSession,\n          _ref$refreshOnCheckAu = _ref.refreshOnCheckAuth,\n          refreshOnCheckAuth = _ref$refreshOnCheckAu === undefined ? false : _ref$refreshOnCheckAu,\n          _ref$expires = _ref.expires,\n          expires = _ref$expires === undefined ? 360 : _ref$expires,\n          _ref$redirectPath = _ref.redirectPath,\n          redirectPath = _ref$redirectPath === undefined ? 'login' : _ref$redirectPath,\n          _ref$server = _ref.server,\n          server = _ref$server === undefined ? false : _ref$server;\n\n      instance.store = store;\n      instance.refreshOnCheckAuth = refreshOnCheckAuth;\n      instance.redirectPath = redirectPath;\n      instance.expires = expires;\n      instance.driver = driver;\n      instance.server = server;\n      instance.validateSession = validateSession;\n\n      // configure the storage\n      var storageOptions = {\n        name: 'redux-react-session'\n      };\n      var localforage = require('localforage');\n      if (driver && driver !== 'COOKIES') {\n        storageOptions.driver = localforage[driver];\n      }\n      instance.storage = localforage.createInstance(storageOptions);\n    }\n  }, {\n    key: 'initSessionService',\n    value: function initSessionService(store, options) {\n      instance = new sessionService(store, options);\n      return sessionService.refreshFromLocalStorage();\n    }\n  }, {\n    key: 'initServerSession',\n    value: function initServerSession(store, req, options) {\n      instance = new sessionService(store, _extends({}, options, { server: true }));\n      var parseCookies = function parseCookies(req) {\n        var list = {};\n        var rc = req.get('cookie');\n        rc && rc.split(';').forEach(function (cookie) {\n          var parts = cookie.split('=');\n          if (parts[0].trim() === _constants.USER_SESSION || parts[0].trim() === _constants.USER_DATA) {\n            list[parts[0].trim()] = JSON.parse(decodeURIComponent(parts[1]));\n          }\n        });\n\n        return list;\n      };\n      return sessionService.saveFromClient(parseCookies(req));\n    }\n  }, {\n    key: 'saveFromClient',\n    value: function saveFromClient(cookies) {\n      return new Promise(function (resolve, reject) {\n        if (cookies[_constants.USER_SESSION]) {\n          sessionService.saveSession(cookies[_constants.USER_SESSION]).then(function () {\n            if (cookies[_constants.USER_DATA]) {\n              sessionService.saveUser(cookies[_constants.USER_DATA]).then(function () {\n                return resolve();\n              });\n            } else {\n              return resolve();\n            }\n          });\n        } else {\n          instance.store.dispatch((0, _actions.getSessionError)());\n          reject('Session not found');\n        }\n      });\n    }\n  }, {\n    key: 'invalidateSession',\n    value: function invalidateSession() {\n      instance.store.dispatch((0, _actions.invalidSession)());\n      sessionService.deleteSession();\n      sessionService.deleteUser();\n    }\n  }, {\n    key: 'attemptLoadUser',\n    value: function attemptLoadUser() {\n      instance.store.dispatch((0, _actions.getSessionSuccess)());\n      return sessionService.loadUser().then(function (user) {\n        instance.store.dispatch((0, _actions.getUserSessionSuccess)(user));\n      }).catch(function () {\n        instance.store.dispatch((0, _actions.getUserSessionError)());\n      });\n    }\n  }, {\n    key: 'refreshFromLocalStorage',\n    value: function refreshFromLocalStorage() {\n      var _this = this;\n\n      return sessionService.loadSession().then(function (session) {\n        if (instance.validateSession) {\n          var value = instance.validateSession(session);\n\n          if ((0, _isPromise2.default)(value)) {\n            return value.then(function (valid) {\n              if (!valid) {\n                throw new Error(\"Session is invalid\");\n              }\n              return _this.attemptLoadUser();\n            }).catch(function () {\n              _this.invalidateSession();\n            });\n          } else if (!value) {\n            _this.invalidateSession();\n            return;\n          }\n        }\n        return _this.attemptLoadUser();\n      }).catch(function () {\n        instance.store.dispatch((0, _actions.getSessionError)());\n      });\n    }\n  }, {\n    key: 'checkAuth',\n    value: function checkAuth(nextState, replace, next) {\n      var _instance = instance,\n          refreshOnCheckAuth = _instance.refreshOnCheckAuth,\n          store = _instance.store;\n\n      sessionService.loadSession().then(function () {\n        refreshOnCheckAuth && store.dispatch((0, _actions.getSessionSuccess)());\n        sessionService.loadUser().then(function (user) {\n          refreshOnCheckAuth && store.dispatch((0, _actions.getUserSessionSuccess)(user));\n          next();\n        }).catch(function () {\n          return next();\n        });\n      }).catch(function () {\n        refreshOnCheckAuth && store.dispatch((0, _actions.getSessionError)());\n        refreshOnCheckAuth && store.dispatch((0, _actions.getUserSessionError)());\n        replace({\n          pathname: instance.redirectPath,\n          state: { nextPathname: nextState.location.pathname }\n        });\n        next();\n      });\n    }\n  }, {\n    key: 'saveSession',\n    value: function saveSession(session) {\n      return new Promise(function (resolve) {\n        if (instance.server) {\n          instance[_constants.USER_SESSION] = session;\n          instance.store.dispatch((0, _actions.getSessionSuccess)());\n          resolve();\n        } else if (instance.driver === 'COOKIES') {\n          Cookies.set(_constants.USER_SESSION, session, { expires: instance.expires });\n          instance.store.dispatch((0, _actions.getSessionSuccess)());\n          resolve();\n        } else {\n          instance.storage.setItem(_constants.USER_SESSION, session).then(function () {\n            instance.store.dispatch((0, _actions.getSessionSuccess)());\n            resolve();\n          }).catch(function () {\n            Cookies.set(_constants.USER_SESSION, session, { expires: instance.expires });\n            instance.store.dispatch((0, _actions.getSessionSuccess)());\n            resolve();\n          });\n        }\n      });\n    }\n  }, {\n    key: 'loadSession',\n    value: function loadSession() {\n      return new Promise(function (resolve, reject) {\n        if (instance.server) {\n          instance[_constants.USER_SESSION] ? resolve(instance[_constants.USER_SESSION]) : reject();\n        } else if (instance.driver === 'COOKIES') {\n          var cookies = Cookies.getJSON(_constants.USER_SESSION);\n          cookies ? resolve(cookies) : reject('Session not found');\n        } else {\n          instance.storage.getItem(_constants.USER_SESSION).then(function (currentSession) {\n            if (currentSession) {\n              resolve(currentSession);\n            } else {\n              var _cookies = Cookies.getJSON(_constants.USER_SESSION);\n              _cookies ? resolve(_cookies) : reject('Session not found');\n            }\n          }).catch(function (err) {\n            return reject(err);\n          });\n        }\n      });\n    }\n  }, {\n    key: 'deleteSession',\n    value: function deleteSession() {\n      return instance.storage.removeItem(_constants.USER_SESSION).then(function () {\n        instance.store.dispatch((0, _actions.getSessionError)());\n        Cookies.remove(_constants.USER_SESSION);\n        delete instance[_constants.USER_SESSION];\n      });\n    }\n  }, {\n    key: 'saveUser',\n    value: function saveUser(user) {\n      return new Promise(function (resolve) {\n        if (instance.server) {\n          instance[_constants.USER_DATA] = user;\n          instance.store.dispatch((0, _actions.getUserSessionSuccess)(user));\n          resolve();\n        } else if (instance.driver === 'COOKIES') {\n          Cookies.set(_constants.USER_DATA, user, { expires: instance.expires });\n          instance.store.dispatch((0, _actions.getUserSessionSuccess)(user));\n          resolve();\n        } else {\n          instance.storage.setItem(_constants.USER_DATA, user).then(function (user) {\n            instance.store.dispatch((0, _actions.getUserSessionSuccess)(user));\n            resolve();\n          }).catch(function () {\n            instance.store.dispatch((0, _actions.getUserSessionSuccess)(user));\n            Cookies.set(_constants.USER_DATA, user, { expires: instance.expires });\n            resolve();\n          });\n        }\n      });\n    }\n  }, {\n    key: 'loadUser',\n    value: function loadUser() {\n      return new Promise(function (resolve, reject) {\n        if (instance.server) {\n          instance[_constants.USER_DATA] ? resolve(instance[_constants.USER_DATA]) : reject();\n        } else if (instance.driver === 'COOKIES') {\n          var cookies = Cookies.getJSON(_constants.USER_DATA);\n          cookies ? resolve(cookies) : reject('User not found');\n        } else {\n          instance.storage.getItem(_constants.USER_DATA).then(function (currentUser) {\n            if (currentUser) {\n              resolve(currentUser);\n            } else {\n              var _cookies2 = Cookies.getJSON(_constants.USER_DATA);\n              _cookies2 ? resolve(_cookies2) : reject('User not found');\n            }\n          }).catch(function (err) {\n            return reject(err);\n          });\n        }\n      });\n    }\n  }, {\n    key: 'deleteUser',\n    value: function deleteUser() {\n      return instance.storage.removeItem(_constants.USER_DATA).then(function () {\n        instance.store.dispatch((0, _actions.getUserSessionError)());\n        Cookies.remove(_constants.USER_DATA);\n        delete instance[_constants.USER_DATA];\n      });\n    }\n  }]);\n\n  return sessionService;\n}();\n\nvar sessionReducer = exports.sessionReducer = _reducer2.default;"]},"metadata":{},"sourceType":"script"}